<!DOCTYPE html> <html lang="en"> <body>
<script src="genericFunctions.js"></script> <script>

///////////////////////
// Global Variables! //
///////////////////////
var programState;
var worldMap;
var playerLocation;
var framesElapsed;
var gridSize;
var gameSpeed;
var MOUNTAIN = 2, GRASS = 0, WATER = 1;

////////////////////////
// Utility functions! //
////////////////////////

function tileWalkable(x,y) {
	walkableTerrain = (worldMap[y][x] == GRASS);
	return walkableTerrain;
}

function tileColorByType ( tileType ) {
	if ( tileType == 0 ) return "green";
	if ( tileType == 1 ) return "blue";
	if ( tileType == 2 ) return "red";
}

function startTheTurn () {
	if (keyIsDown ('up') && tileWalkable(player.x,player.y-1)) player.moveY = -1;
	else if (keyIsDown ('down') && tileWalkable(player.x,player.y+1)) player.moveY = 1;
	else if (keyIsDown ('left') && tileWalkable(player.x-1,player.y)) player.moveX = -1;
	else if (keyIsDown ('right') && tileWalkable(player.x+1,player.y)) player.moveX = 1;
	if (player.moveX != 0 || player.moveY != 0) framesElapsed = 0;
	// TODO Make every other object move too here.
}

///////////////////////////////////
// Important backbone functions! //
///////////////////////////////////

function updateGame() {
	if (framesElapsed >= gridSize) {
		startTheTurn ();
	}
	else if ( framesElapsed < gridSize ) {
		framesElapsed += gameSpeed;
		if ( framesElapsed >= gridSize ) {
			player.x += player.moveX; 
			player.moveX = 0;
			player.y += player.moveY; 
			player.moveY = 0;
			// TODO Handle other object's actions too.
		}
	}
}

function renderGame() {
	for (x = 0; x < 640/gridSize; x++) {
		for (y = 0; y < 480/gridSize; y++) {
			var tileColor = tileColorByType ( worldMap[y][x] );
			fillBox (x*gridSize,y*gridSize,gridSize,gridSize,tileColor);
		}
	}
	fillCircle(player.x*20+10+player.moveX*framesElapsed,
			   player.y*20+10+player.moveY*framesElapsed,
			   10,"black");
}

function updateMainMenu() {
	if ( keyIsDown ("right") ) programState = 1;
}

function renderMainMenu() {
	writeText("Game menu!",10,10, "black");
	writeText("Press right to start.",10,30, "black");
}

///////////////////////////
// Background functions! //
///////////////////////////

function setup () {
	programState = 0;
	player = {x:1,y:1,moveX:0,moveY:0};
	gridSize = 20;
	framesElapsed = gridSize;
	gameSpeed = 2;
	worldMap = [
		[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],
		[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
		[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
		[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
		[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
		[0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
		[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
		[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
		[0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
		[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
		[0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0],
		[0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
		[0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
		[0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0],
		[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,2,0,0,0,0,0,0,0,0,0],
		[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,2,0,0,0,0,0,0,0,0,0],
		[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
		[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
		[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0],
		[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0],
		[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
		[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
		[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
		[2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2]];
}

function update () { 
	if ( programState == 0 ) updateMainMenu();
	else if ( programState == 1 ) updateGame();
}

function render () { 
	clear();
	if ( programState == 0 ) renderMainMenu();
	else if ( programState == 1 ) renderGame();
}

/////////////////////
// Start the game. //
/////////////////////

setup ();
setInterval (function () {update () ; render () ;} , 20) ;

</script></body></html>
