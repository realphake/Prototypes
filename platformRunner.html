<!DOCTYPE html>
<html lang="en">
<body>
	<script src="genericFunctions.js"></script>
	<script>
	
	// Game modding variables.
	var worldSpeed = 3;
	var walkSpeed = 3;
	var gravity = 1;
	var jumpHeight = 15;
	// That was them!
	
	var player = {x:20, y:20, w:10, h:20, fall:0, dead:false} ;
	var ground = [ {x:70, w:100, y:400}, {x:10, w:80, y:300} ];
	var enemies = [ {x:640, y:400, speed:1} ]; 
	
	function setup () {
		// Initialize the game here.
	}
	
	function update () { 
		// Scroll world
		for (var i = ground.length-1; i >= 0; i--) { 
			ground[i].x -= worldSpeed;
			if (ground[i].x+ground[i].w <= 0) ground.splice(i,1);
		}
		for (var i = enemies.length-1; i >= 0; i--) { 
			enemies[i].x -= worldSpeed-enemies[i].speed;
			if (enemies[i].x <= 0) enemies.splice(i,1);
		}
		// Spawn objects
		if (Math.random() < 0.04) ground.push( {x:640, w:640/randDouble(1,15), y:randInt(-2,6)*20+player.y} );
		if (Math.random() < 0.03) enemies.push( {x:640, y:randInt(0,24)*20+5, speed:randInt(1,3)} );
		// Walking
		if (keyIsDown ('left') ) player.x -= walkSpeed;
		if (keyIsDown ('right') ) player.x += walkSpeed;
		// Falling & Jumping
		var groundHeight = 470;
		for (var i = 0; i < ground.length; i++)
			if (ground[i].y < groundHeight && ground[i].y >= player.y+player.h && player.x+player.w > ground[i].x && player.x < ground[i].x+ground[i].w)
				groundHeight = ground[i].y;
		if (player.y+player.h+player.fall+gravity < groundHeight) {player.fall += gravity; player.y += player.fall;}
		else {player.y = groundHeight-player.h; player.fall = 0;}
		if (groundHeight == player.y+player.h && keyIsDown('z') ) { 
			if ( keyIsDown('down') ) player.y += 1;
			else player.fall -= jumpHeight; 
		}
		// Enemy collision
		for (var i = enemies.length-1; i >= 0; i--) { 
			if (enemies[i].x > player.x && enemies[i].x < player.x+player.w && enemies[i].y > player.y && enemies[i].y < player.y+player.h )
				player.dead = true;
		}
	}
	
	function render () { 
		clear();
		// Player
		if (player.dead) drawBox (player.x, player.y, player.w, player.h, 'red') ;
		else drawBox (player.x, player.y, player.w, player.h, 'blue') ;
		// Ground
		drawLine (0, 470, 640, 470, 'green') ;
		for (var i = 0; i < ground.length; i++)
			drawLine (ground[i].x, ground[i].y, ground[i].x+ground[i].w, ground[i].y, 'green') ;
		// Enemies
		for (var i = 0; i < enemies.length; i++)
			drawCircle (enemies[i].x, enemies[i].y, 2, 'red') ;
	}
	
	setup(); setInterval (function () {update () ; render () ;}, 20) ;

	</script>

</body>
</html>

